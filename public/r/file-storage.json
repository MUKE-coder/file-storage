{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "file-storage",
  "type": "registry:block",
  "title": "File Storage System",
  "description": "A complete file storage system with AWS S3 and Cloudflare R2 support. Includes dropzone component, file tracking, categories example, and all necessary API routes. NOTE: This component includes a prisma schema EXAMPLE file (schema.prisma.example) - you need to manually add the models to your existing schema.prisma file.",
  "dependencies": [
    "@aws-sdk/client-s3",
    "@aws-sdk/s3-request-presigner",
    "@tanstack/react-query",
    "react-dropzone",
    "uuid",
    "zod",
    "sonner",
    "react-hook-form",
    "server-only",
    "@prisma/client",
    "@prisma/adapter-pg",
    "dotenv",
    "pg"
  ],
  "devDependencies": [
    "@types/uuid",
    "@types/pg",
    "prisma",
    "tsx"
  ],
  "registryDependencies": [
    "button",
    "card",
    "dialog",
    "input",
    "textarea",
    "label",
    "switch",
    "form",
    "scroll-area",
    "alert"
  ],
  "files": [
    {
      "path": "registry/new-york/file-storage/components/ui/dropzone.tsx",
      "content": "/* eslint-disable @next/next/no-img-element */\n\"use client\";\n\nimport {\n  File,\n  Image as ImageIcon,\n  Loader2,\n  Trash2,\n  Upload,\n  X,\n} from \"lucide-react\";\nimport { useCallback, useEffect, useState } from \"react\";\nimport type { FileRejection } from \"react-dropzone\";\nimport { useDropzone } from \"react-dropzone\";\nimport { toast } from \"sonner\";\nimport { v4 as uuidv4 } from \"uuid\";\n\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { cn } from \"@/lib/utils\";\n\nexport interface FileWithMetadata {\n  id: string;\n  file: File;\n  uploading: boolean;\n  progress: number;\n  key?: string;\n  provider?: string;\n  publicUrl?: string;\n  isDeleting: boolean;\n  error: boolean;\n  objectUrl?: string;\n}\n\ninterface DropzoneProps {\n  provider: \"aws\" | \"cloudflare\";\n  variant?: \"default\" | \"compact\" | \"minimal\" | \"avatar\" | \"inline\";\n  accept?: Record<string, string[]>;\n  maxFiles?: number;\n  maxSize?: number;\n  onFilesChange?: (files: FileWithMetadata[]) => void;\n  className?: string;\n  disabled?: boolean;\n  helperText?: string;\n}\n\n/**\n * Extract key from S3/R2 public URL\n * Example: https://bucket.s3.region.amazonaws.com/key.png -> key.png\n */\nexport function extractKeyFromUrl(url: string): string | null {\n  if (!url) return null;\n  try {\n    const urlObj = new URL(url);\n    // Remove leading slash and return the path\n    return urlObj.pathname.substring(1);\n  } catch (error) {\n    console.error(\"Error extracting key from URL:\", error);\n    return null;\n  }\n}\n\nexport function Dropzone({\n  provider,\n  variant = \"default\",\n  accept = {\n    \"image/*\": [],\n    \"application/pdf\": [],\n    \"application/msword\": [],\n    \"application/vnd.openxmlformats-officedocument.wordprocessingml.document\":\n      [],\n    \"application/zip\": [],\n  },\n  maxFiles = 5,\n  maxSize = 1024 * 1024 * 10, // 10MB\n  onFilesChange,\n  className,\n  disabled = false,\n  helperText,\n}: DropzoneProps) {\n  const [files, setFiles] = useState<FileWithMetadata[]>([]);\n\n  useEffect(() => {\n    onFilesChange?.(files);\n  }, [files, onFilesChange]);\n\n  const removeFile = async (fileId: string) => {\n    try {\n      const fileToRemove = files.find((f) => f.id === fileId);\n      if (!fileToRemove) return;\n\n      if (fileToRemove.objectUrl) {\n        URL.revokeObjectURL(fileToRemove.objectUrl);\n      }\n\n      setFiles((prevFiles) =>\n        prevFiles.map((f) => (f.id === fileId ? { ...f, isDeleting: true } : f))\n      );\n\n      // Only attempt to delete from server if the file was successfully uploaded\n      if (fileToRemove.key && fileToRemove.publicUrl) {\n        const endpoint =\n          provider === \"aws\" ? \"/api/s3/delete\" : \"/api/r2/delete\";\n        const response = await fetch(endpoint, {\n          method: \"DELETE\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ key: fileToRemove.key }),\n        });\n\n        if (!response.ok) {\n          toast.error(\"Failed to delete file from server\");\n          setFiles((prevFiles) =>\n            prevFiles.map((f) =>\n              f.id === fileId ? { ...f, isDeleting: false, error: true } : f\n            )\n          );\n          return;\n        }\n      }\n\n      setFiles((prevFiles) => prevFiles.filter((f) => f.id !== fileId));\n      toast.success(\"File removed successfully\");\n    } catch (error) {\n      console.log(error);\n      toast.error(\"Failed to delete file\");\n      setFiles((prevFiles) =>\n        prevFiles.map((f) =>\n          f.id === fileId ? { ...f, isDeleting: false, error: true } : f\n        )\n      );\n    }\n  };\n\n  const uploadFile = async (file: File) => {\n    setFiles((prevFiles) =>\n      prevFiles.map((f) => (f.file === file ? { ...f, uploading: true } : f))\n    );\n\n    try {\n      const endpoint = provider === \"aws\" ? \"/api/s3/upload\" : \"/api/r2/upload\";\n      const presignedResponse = await fetch(endpoint, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          filename: file.name,\n          contentType: file.type,\n          size: file.size,\n        }),\n      });\n\n      if (!presignedResponse.ok) {\n        toast.error(\"Failed to get presigned URL\");\n        setFiles((prevFiles) =>\n          prevFiles.map((f) =>\n            f.file === file\n              ? { ...f, uploading: false, progress: 0, error: true }\n              : f\n          )\n        );\n        return;\n      }\n\n      const { presignedUrl, key, publicUrl } = await presignedResponse.json();\n\n      await new Promise<void>((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n\n        xhr.upload.onprogress = (event) => {\n          if (event.lengthComputable) {\n            const percentComplete = (event.loaded / event.total) * 100;\n            setFiles((prevFiles) =>\n              prevFiles.map((f) =>\n                f.file === file\n                  ? {\n                      ...f,\n                      progress: Math.round(percentComplete),\n                      key: key,\n                      publicUrl: publicUrl,\n                      provider: provider,\n                    }\n                  : f\n              )\n            );\n          }\n        };\n\n        xhr.onload = () => {\n          if (xhr.status === 200 || xhr.status === 204) {\n            setFiles((prevFiles) =>\n              prevFiles.map((f) =>\n                f.file === file\n                  ? { ...f, progress: 100, uploading: false, error: false }\n                  : f\n              )\n            );\n            toast.success(\"File uploaded successfully\");\n            resolve();\n          } else {\n            reject(new Error(`Upload failed with status: ${xhr.status}`));\n          }\n        };\n\n        xhr.onerror = () => {\n          reject(new Error(\"Upload failed\"));\n        };\n\n        xhr.open(\"PUT\", presignedUrl);\n        xhr.setRequestHeader(\"Content-Type\", file.type);\n        xhr.send(file);\n      });\n    } catch (error) {\n      console.log(error);\n      toast.error(\"Upload failed\");\n      setFiles((prevFiles) =>\n        prevFiles.map((f) =>\n          f.file === file\n            ? { ...f, uploading: false, progress: 0, error: true }\n            : f\n        )\n      );\n    }\n  };\n\n  const onDrop = useCallback((acceptedFiles: File[]) => {\n    if (acceptedFiles.length) {\n      setFiles((prevFiles) => [\n        ...prevFiles,\n        ...acceptedFiles.map((file) => ({\n          id: uuidv4(),\n          file,\n          uploading: false,\n          progress: 0,\n          isDeleting: false,\n          error: false,\n          objectUrl: URL.createObjectURL(file),\n        })),\n      ]);\n\n      acceptedFiles.forEach(uploadFile);\n    }\n  }, []);\n\n  const onDropRejected = useCallback(\n    (fileRejections: FileRejection[]) => {\n      if (fileRejections.length) {\n        const tooManyFiles = fileRejections.find(\n          (rejection) => rejection.errors[0].code === \"too-many-files\"\n        );\n        const fileTooLarge = fileRejections.find(\n          (rejection) => rejection.errors[0].code === \"file-too-large\"\n        );\n\n        if (tooManyFiles) {\n          toast.error(`Too many files. Maximum ${maxFiles} files allowed.`);\n        }\n        if (fileTooLarge) {\n          toast.error(\n            `File too large. Maximum ${maxSize / (1024 * 1024)}MB allowed.`\n          );\n        }\n      }\n    },\n    [maxFiles, maxSize]\n  );\n\n  const { getRootProps, getInputProps, isDragActive } = useDropzone({\n    onDrop,\n    onDropRejected,\n    maxFiles,\n    maxSize,\n    accept,\n    disabled,\n  });\n\n  // Render variants\n  if (variant === \"avatar\") {\n    const currentFile = files[0];\n    return (\n      <div className={cn(\"relative\", className)}>\n        <div\n          {...getRootProps()}\n          className={cn(\n            \"relative h-32 w-32 cursor-pointer overflow-hidden rounded-full border-2 border-dashed transition-colors\",\n            isDragActive\n              ? \"border-primary bg-primary/10\"\n              : \"border-border hover:border-primary\",\n            disabled && \"cursor-not-allowed opacity-50\"\n          )}\n        >\n          <input {...getInputProps()} />\n          {currentFile?.objectUrl ? (\n            <img\n              src={currentFile.objectUrl}\n              alt=\"Avatar\"\n              className=\"h-full w-full object-cover\"\n            />\n          ) : (\n            <div className=\"flex h-full w-full items-center justify-center bg-muted\">\n              <ImageIcon className=\"h-8 w-8 text-muted-foreground\" />\n            </div>\n          )}\n          {currentFile?.uploading && (\n            <div className=\"absolute inset-0 flex items-center justify-center bg-black/50\">\n              <div className=\"font-medium text-white\">\n                {currentFile.progress}%\n              </div>\n            </div>\n          )}\n        </div>\n        {currentFile && (\n          <Button\n            size=\"icon\"\n            variant=\"destructive\"\n            className=\"absolute -top-2 -right-2 h-8 w-8 rounded-full\"\n            onClick={() => removeFile(currentFile.id)}\n            disabled={currentFile.isDeleting || currentFile.uploading}\n          >\n            {currentFile.isDeleting ? (\n              <Loader2 className=\"h-4 w-4 animate-spin\" />\n            ) : (\n              <X className=\"h-4 w-4\" />\n            )}\n          </Button>\n        )}\n      </div>\n    );\n  }\n\n  if (variant === \"minimal\") {\n    return (\n      <div className={cn(\"space-y-2\", className)}>\n        <div {...getRootProps()}>\n          <input {...getInputProps()} />\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            className=\"w-full\"\n            disabled={disabled}\n          >\n            <Upload className=\"mr-2 h-4 w-4\" />\n            Upload Files\n          </Button>\n        </div>\n        {helperText && (\n          <p className=\"text-xs text-muted-foreground\">{helperText}</p>\n        )}\n        {files.length > 0 && (\n          <div className=\"space-y-2\">\n            {files.map((file) => (\n              <div\n                key={file.id}\n                className=\"flex items-center justify-between rounded-md border p-2\"\n              >\n                <div className=\"flex min-w-0 flex-1 items-center gap-2\">\n                  <File className=\"h-4 w-4 flex-shrink-0 text-muted-foreground\" />\n                  <span className=\"truncate text-sm\">{file.file.name}</span>\n                  {file.uploading && (\n                    <span className=\"text-xs text-muted-foreground\">\n                      {file.progress}%\n                    </span>\n                  )}\n                </div>\n                <Button\n                  size=\"icon\"\n                  variant=\"ghost\"\n                  className=\"h-8 w-8 flex-shrink-0\"\n                  onClick={() => removeFile(file.id)}\n                  disabled={file.isDeleting || file.uploading}\n                >\n                  {file.isDeleting ? (\n                    <Loader2 className=\"h-3 w-3 animate-spin\" />\n                  ) : (\n                    <Trash2 className=\"h-3 w-3\" />\n                  )}\n                </Button>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  if (variant === \"inline\") {\n    return (\n      <div className={cn(\"flex items-center gap-2\", className)}>\n        <div {...getRootProps()} className=\"flex-1\">\n          <input {...getInputProps()} />\n          <Button\n            type=\"button\"\n            variant=\"outline\"\n            size=\"sm\"\n            className=\"w-full\"\n            disabled={disabled}\n          >\n            <Upload className=\"mr-2 h-3 w-3\" />\n            Choose File\n          </Button>\n        </div>\n        {files.length > 0 && (\n          <div className=\"flex items-center gap-2\">\n            <span className=\"max-w-[150px] truncate text-sm text-muted-foreground\">\n              {files[0].file.name}\n            </span>\n            <Button\n              size=\"icon\"\n              variant=\"ghost\"\n              className=\"h-8 w-8\"\n              onClick={() => removeFile(files[0].id)}\n              disabled={files[0].isDeleting || files[0].uploading}\n            >\n              {files[0].isDeleting ? (\n                <Loader2 className=\"h-3 w-3 animate-spin\" />\n              ) : (\n                <Trash2 className=\"h-3 w-3\" />\n              )}\n            </Button>\n          </div>\n        )}\n      </div>\n    );\n  }\n\n  const isCompact = variant === \"compact\";\n\n  return (\n    <div className={cn(\"w-full\", className)}>\n      <Card\n        {...getRootProps()}\n        className={cn(\n          \"relative cursor-pointer border-2 border-dashed transition-colors duration-200 ease-in-out\",\n          isCompact ? \"h-32\" : \"h-64\",\n          isDragActive\n            ? \"border-solid border-primary bg-primary/10\"\n            : \"border-border hover:border-primary\",\n          disabled && \"cursor-not-allowed opacity-50\"\n        )}\n      >\n        <CardContent className=\"flex h-full w-full items-center justify-center p-4\">\n          <input {...getInputProps()} />\n          {isDragActive ? (\n            <div className=\"flex flex-col items-center gap-2\">\n              <Upload className=\"h-8 w-8 text-primary\" />\n              <p className=\"text-center text-sm\">Drop the files here...</p>\n            </div>\n          ) : (\n            <div className=\"flex flex-col items-center gap-3\">\n              <div className=\"flex gap-2\">\n                <ImageIcon className=\"h-6 w-6 text-muted-foreground\" />\n                <File className=\"h-6 w-6 text-muted-foreground\" />\n              </div>\n              <p className=\"text-center text-sm text-muted-foreground\">\n                Drag & drop files here, or click to select\n              </p>\n              <Button size={isCompact ? \"sm\" : \"default\"} type=\"button\">\n                Select Files\n              </Button>\n              {helperText && (\n                <p className=\"text-center text-xs text-muted-foreground\">\n                  {helperText}\n                </p>\n              )}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {files.length > 0 && (\n        <div className=\"mt-6 grid grid-cols-2 gap-4 sm:grid-cols-3 md:grid-cols-4\">\n          {files.map(\n            ({\n              id,\n              file,\n              uploading,\n              progress,\n              isDeleting,\n              error,\n              objectUrl,\n            }) => {\n              const isImage = file.type.startsWith(\"image/\");\n\n              return (\n                <div key={id} className=\"flex flex-col gap-1\">\n                  <div className=\"relative aspect-square overflow-hidden rounded-lg border\">\n                    {isImage ? (\n                      <img\n                        src={objectUrl}\n                        alt={file.name}\n                        className=\"h-full w-full object-cover\"\n                      />\n                    ) : (\n                      <div className=\"flex h-full w-full items-center justify-center bg-muted\">\n                        <File className=\"h-12 w-12 text-muted-foreground\" />\n                      </div>\n                    )}\n\n                    <Button\n                      variant=\"destructive\"\n                      size=\"icon\"\n                      className=\"absolute top-2 right-2 h-6 w-6\"\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        removeFile(id);\n                      }}\n                      disabled={isDeleting || uploading}\n                      type=\"button\"\n                    >\n                      {isDeleting ? (\n                        <Loader2 className=\"h-3 w-3 animate-spin\" />\n                      ) : (\n                        <Trash2 className=\"h-3 w-3\" />\n                      )}\n                    </Button>\n\n                    {uploading && !isDeleting && (\n                      <div className=\"absolute inset-0 flex items-center justify-center bg-black/50\">\n                        <div className=\"text-lg font-medium text-white\">\n                          {progress}%\n                        </div>\n                      </div>\n                    )}\n\n                    {error && (\n                      <div className=\"absolute inset-0 flex items-center justify-center bg-red-500/50\">\n                        <div className=\"font-medium text-white\">Error</div>\n                      </div>\n                    )}\n                  </div>\n                  <p className=\"truncate px-1 text-xs text-muted-foreground\">\n                    {file.name}\n                  </p>\n                </div>\n              );\n            }\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// Cleanup hook on unmount\nexport function useDropzoneCleanup(files: FileWithMetadata[]) {\n  useEffect(() => {\n    return () => {\n      files.forEach((file) => {\n        if (file.objectUrl) {\n          URL.revokeObjectURL(file.objectUrl);\n        }\n      });\n    };\n  }, [files]);\n}\n",
      "type": "registry:ui",
      "target": "components/ui/dropzone.tsx"
    },
    {
      "path": "registry/new-york/file-storage/components/ui/error-display.tsx",
      "content": "interface QueryErrorDisplayProps {\n  error: Error;\n  onRetry?: () => void;\n  title?: string;\n  retryText?: string;\n}\n\nexport function QueryErrorDisplay({\n  error,\n  onRetry,\n  title = \"Something went wrong\",\n  retryText = \"Try Again\",\n}: QueryErrorDisplayProps) {\n  return (\n    <div className=\"text-center py-12 px-4\">\n      <div className=\"max-w-md mx-auto\">\n        <div className=\"text-red-500 mb-4\">\n          <svg\n            className=\"w-12 h-12 mx-auto\"\n            fill=\"none\"\n            stroke=\"currentColor\"\n            viewBox=\"0 0 24 24\"\n            xmlns=\"http://www.w3.org/2000/svg\"\n          >\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth=\"2\"\n              d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\n            />\n          </svg>\n        </div>\n        <h3 className=\"text-xl font-semibold text-gray-900 mb-2\">{title}</h3>\n        <p className=\"text-gray-600 mb-4\">\n          {error.message || \"Failed to load data. Please try again.\"}\n        </p>\n        {onRetry && (\n          <button\n            onClick={onRetry}\n            className=\"bg-zinc-900 text-white px-6 py-2 rounded-md hover:bg-zinc-800 transition-colors\"\n          >\n            {retryText}\n          </button>\n        )}\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:ui",
      "target": "components/ui/error-display.tsx"
    },
    {
      "path": "registry/new-york/file-storage/components/file-storage/categories/Categories.tsx",
      "content": "/* eslint-disable @next/next/no-img-element */\n\"use client\";\n\nimport React, { useState, useMemo } from \"react\";\nimport {\n  Search,\n  Filter,\n  Edit,\n  ChevronLeft,\n  ChevronRight,\n  RefreshCcw,\n  PackageX,\n  AlertCircle,\n} from \"lucide-react\";\nimport CategoryForm from \"./CategoryForm\";\nimport { getHomeCategories } from \"@/lib/api/categories\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Alert, AlertDescription, AlertTitle } from \"@/components/ui/alert\";\nimport { getNormalDate } from \"@/lib/getNormalDate\";\nimport { DeleteCategoryButton } from \"./DeleteCategoryButton\";\n\n// Loading Skeleton Component\nconst TableSkeleton = () => {\n  return (\n    <tbody>\n      {[...Array(5)].map((_, i) => (\n        <tr key={i} className=\"border-b border-slate-100\">\n          <td className=\"px-8 py-5\">\n            <div className=\"flex items-center gap-4 animate-pulse\">\n              <div className=\"w-10 h-10 rounded-sm bg-slate-200 shrink-0\"></div>\n              <div className=\"h-4 bg-slate-200 rounded w-32\"></div>\n            </div>\n          </td>\n          <td className=\"px-8 py-5\">\n            <div className=\"h-4 bg-slate-200 rounded w-24 animate-pulse\"></div>\n          </td>\n          <td className=\"px-8 py-5\">\n            <div className=\"h-6 bg-slate-200 rounded-full w-16 animate-pulse\"></div>\n          </td>\n          <td className=\"px-8 py-5\">\n            <div className=\"h-6 bg-slate-200 rounded-xl w-20 animate-pulse\"></div>\n          </td>\n          <td className=\"px-8 py-5\">\n            <div className=\"h-4 bg-slate-200 rounded w-24 animate-pulse\"></div>\n          </td>\n          <td className=\"px-8 py-5\">\n            <div className=\"flex justify-end gap-1\">\n              <div className=\"w-9 h-9 bg-slate-200 rounded-xl animate-pulse\"></div>\n              <div className=\"w-9 h-9 bg-slate-200 rounded-xl animate-pulse\"></div>\n            </div>\n          </td>\n        </tr>\n      ))}\n    </tbody>\n  );\n};\n\n// Empty State Component\nconst EmptyState = ({ searchTerm }: { searchTerm: string }) => {\n  return (\n    <tbody>\n      <tr>\n        <td colSpan={6} className=\"px-8 py-16\">\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-20 h-20 rounded-full bg-slate-100 flex items-center justify-center mb-4\">\n              <PackageX className=\"w-10 h-10 text-slate-400\" />\n            </div>\n            <h3 className=\"text-xl font-bold text-slate-900 mb-2\">\n              {searchTerm ? \"No categories found\" : \"No categories yet\"}\n            </h3>\n            <p className=\"text-slate-500 text-center max-w-md mb-6\">\n              {searchTerm\n                ? `We couldn't find any categories matching \"${searchTerm}\". Try adjusting your search.`\n                : \"Get started by creating your first category to organize your products.\"}\n            </p>\n            {!searchTerm && <CategoryForm />}\n          </div>\n        </td>\n      </tr>\n    </tbody>\n  );\n};\n\nconst Categories: React.FC = () => {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [page, setPage] = useState(1);\n  const itemsPerPage = 5;\n\n  const {\n    data: categories = [],\n    isLoading,\n    error,\n    refetch,\n    isRefetching,\n  } = useQuery({\n    queryKey: [\"categories\"],\n    queryFn: getHomeCategories,\n  });\n\n  // Memoize filtered categories to avoid recalculation on every render\n  const filteredCategories = useMemo(() => {\n    return categories.filter(\n      (c) =>\n        c.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n        c.slug.toLowerCase().includes(searchTerm.toLowerCase())\n    );\n  }, [categories, searchTerm]);\n\n  // Memoize pagination calculations\n  const { totalPages, paginatedCategories } = useMemo(() => {\n    const total = Math.ceil(filteredCategories.length / itemsPerPage);\n    const paginated = filteredCategories.slice(\n      (page - 1) * itemsPerPage,\n      page * itemsPerPage\n    );\n    return { totalPages: total, paginatedCategories: paginated };\n  }, [filteredCategories, page, itemsPerPage]);\n\n  // Reset to page 1 when search term changes\n  React.useEffect(() => {\n    setPage(1);\n  }, [searchTerm]);\n\n  return (\n    <div className=\"space-y-8 animate-in fade-in duration-500\">\n      {/* Header */}\n      <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n        <div>\n          <h1 className=\"text-4xl font-black text-slate-900 tracking-tight\">\n            Categories\n          </h1>\n          <p className=\"text-slate-500 font-medium\">\n            Organize your product catalog for better discoverability.\n          </p>\n        </div>\n        <div className=\"flex gap-4 items-center\">\n          <Button\n            disabled={isRefetching}\n            size={\"icon\"}\n            onClick={() => refetch()}\n            className=\"relative\"\n          >\n            <RefreshCcw className={`${isRefetching ? \"animate-spin\" : \"\"}`} />\n          </Button>\n          <CategoryForm />\n        </div>\n      </div>\n\n      {/* Error Alert */}\n      {error && (\n        <Alert variant=\"destructive\" className=\"rounded-2xl border-2\">\n          <AlertCircle className=\"h-5 w-5\" />\n          <AlertTitle className=\"font-bold\">\n            Error Loading Categories\n          </AlertTitle>\n          <AlertDescription className=\"flex items-center justify-between\">\n            <span>\n              {error instanceof Error\n                ? error.message\n                : \"Failed to load categories. Please try again.\"}\n            </span>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => refetch()}\n              className=\"ml-4\"\n            >\n              <RefreshCcw className=\"w-4 h-4 mr-2\" />\n              Retry\n            </Button>\n          </AlertDescription>\n        </Alert>\n      )}\n\n      {/* Main Content */}\n      <div className=\"bg-white rounded-[40px] border border-slate-200 shadow-sm overflow-hidden flex flex-col\">\n        {/* Search and Filter Controls */}\n        <div className=\"p-6 border-b border-slate-100 flex flex-col md:flex-row gap-4 justify-between items-center\">\n          <div className=\"relative w-full md:w-96 group\">\n            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 group-focus-within:text-indigo-600 transition-colors\" />\n            <input\n              type=\"text\"\n              placeholder=\"Search categories...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              disabled={isLoading}\n              className=\"w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm font-medium focus:outline-none focus:ring-4 focus:ring-indigo-50 focus:bg-white transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n            />\n          </div>\n          <div className=\"flex gap-3 w-full md:w-auto\">\n            <button\n              className=\"flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-3 bg-white border border-slate-200 rounded-2xl text-sm font-bold text-slate-700 hover:bg-slate-50 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n              disabled={isLoading}\n            >\n              <Filter className=\"w-4 h-4\" /> All Status\n            </button>\n          </div>\n        </div>\n\n        {/* Table */}\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-left\">\n            <thead className=\"bg-slate-50/50 text-slate-400 text-[10px] font-black uppercase tracking-widest border-b border-slate-100\">\n              <tr>\n                <th className=\"px-8 py-5\">Category Name</th>\n                <th className=\"px-8 py-5\">Slug</th>\n                <th className=\"px-8 py-5\">Products</th>\n                <th className=\"px-8 py-5\">Status</th>\n                <th className=\"px-8 py-5\">Last Updated</th>\n                <th className=\"px-8 py-5 text-right\">Actions</th>\n              </tr>\n            </thead>\n\n            {/* Loading State */}\n            {isLoading && <TableSkeleton />}\n\n            {/* Empty State */}\n            {!isLoading && filteredCategories.length === 0 && (\n              <EmptyState searchTerm={searchTerm} />\n            )}\n\n            {/* Data Rows */}\n            {!isLoading && filteredCategories.length > 0 && (\n              <tbody className=\"divide-y divide-slate-100\">\n                {paginatedCategories.map((cat) => {\n                  const updatedDate = getNormalDate(cat.updatedAt);\n                  return (\n                    <tr\n                      key={cat.id}\n                      className=\"group hover:bg-slate-50/80 transition-all\"\n                    >\n                      <td className=\"px-8 py-5\">\n                        <div className=\"flex items-center gap-4\">\n                          <div className=\"w-10 h-10 rounded-sm overflow-hidden shrink-0 bg-slate-100 border border-slate-200 group-hover:scale-105 transition-transform\">\n                            <img\n                              className=\"w-full h-full object-cover\"\n                              src={cat.image}\n                              alt={cat.name}\n                              onError={(e) => {\n                                e.currentTarget.src = `https://picsum.photos/seed/${cat.id}/100/100`;\n                              }}\n                            />\n                          </div>\n                          <span className=\"font-bold text-slate-900 group-hover:text-indigo-600 transition-colors\">\n                            {cat.name}\n                          </span>\n                        </div>\n                      </td>\n                      <td className=\"px-8 py-5 text-sm font-medium text-slate-500\">\n                        /{cat.slug}\n                      </td>\n                      <td className=\"px-8 py-5\">\n                        <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-slate-100 text-slate-600\">\n                          {cat.productsCount || 0} items\n                        </span>\n                      </td>\n                      <td className=\"px-8 py-5\">\n                        <span\n                          className={`px-3 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-wider ${\n                            cat.isActive\n                              ? \"bg-emerald-50 text-emerald-600\"\n                              : \"bg-slate-100 text-slate-400\"\n                          }`}\n                        >\n                          {cat.isActive ? \"ACTIVE\" : \"INACTIVE\"}\n                        </span>\n                      </td>\n                      <td className=\"px-8 py-5 text-sm font-bold text-slate-400\">\n                        {updatedDate}\n                      </td>\n                      <td className=\"px-8 py-5 text-right\">\n                        <div className=\"flex justify-end gap-1\">\n                          <button className=\"p-2.5 text-slate-400 hover:text-indigo-600 hover:bg-white rounded-xl transition-all shadow-sm hover:shadow-md border border-transparent hover:border-slate-100\">\n                            <Edit className=\"w-4 h-4\" />\n                          </button>\n                          <DeleteCategoryButton\n                            categoryId={cat.id}\n                            categoryName={cat.name}\n                          />\n                        </div>\n                      </td>\n                    </tr>\n                  );\n                })}\n              </tbody>\n            )}\n          </table>\n        </div>\n\n        {/* Pagination Footer - Only show when there are categories */}\n        {!isLoading && filteredCategories.length > 0 && (\n          <div className=\"p-6 bg-slate-50/50 border-t border-slate-100 flex flex-col sm:flex-row justify-between items-center gap-4\">\n            <div className=\"text-xs font-bold text-slate-500\">\n              Showing{\" \"}\n              <span className=\"text-slate-900\">\n                {Math.min(\n                  filteredCategories.length,\n                  (page - 1) * itemsPerPage + 1\n                )}\n                -{Math.min(filteredCategories.length, page * itemsPerPage)}\n              </span>{\" \"}\n              of{\" \"}\n              <span className=\"text-slate-900\">\n                {filteredCategories.length}\n              </span>{\" \"}\n              {filteredCategories.length === 1 ? \"category\" : \"categories\"}\n            </div>\n            <div className=\"flex items-center gap-2\">\n              <button\n                disabled={page === 1}\n                onClick={() => setPage((p) => p - 1)}\n                className=\"p-2 text-slate-400 hover:text-indigo-600 disabled:opacity-30 transition-all disabled:cursor-not-allowed\"\n                aria-label=\"Previous page\"\n              >\n                <ChevronLeft className=\"w-5 h-5\" />\n              </button>\n\n              {/* Page Numbers */}\n              {totalPages <= 5 ? (\n                // Show all pages if 5 or fewer\n                [...Array(totalPages)].map((_, i) => (\n                  <button\n                    key={i}\n                    onClick={() => setPage(i + 1)}\n                    className={`w-8 h-8 rounded-xl text-xs font-black transition-all ${\n                      page === i + 1\n                        ? \"bg-indigo-600 text-white shadow-lg shadow-indigo-100\"\n                        : \"text-slate-500 hover:bg-slate-200\"\n                    }`}\n                  >\n                    {i + 1}\n                  </button>\n                ))\n              ) : (\n                // Show condensed pagination for more than 5 pages\n                <span className=\"text-xs font-black text-slate-900 px-4\">\n                  Page {page} of {totalPages}\n                </span>\n              )}\n\n              <button\n                disabled={page >= totalPages}\n                onClick={() => setPage((p) => p + 1)}\n                className=\"p-2 text-slate-400 hover:text-indigo-600 disabled:opacity-30 transition-all disabled:cursor-not-allowed\"\n                aria-label=\"Next page\"\n              >\n                <ChevronRight className=\"w-5 h-5\" />\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default Categories;\n",
      "type": "registry:component",
      "target": "components/file-storage/categories/Categories.tsx"
    },
    {
      "path": "registry/new-york/file-storage/components/file-storage/categories/CategoryForm.tsx",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\n\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\n\nimport { Input } from \"@/components/ui/input\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Label } from \"@/components/ui/label\";\nimport { Switch } from \"@/components/ui/switch\";\n\nimport {\n  Form,\n  FormControl,\n  FormDescription,\n  FormField,\n  FormItem,\n  FormLabel,\n  FormMessage,\n} from \"@/components/ui/form\";\nimport { ScrollArea } from \"@/components/ui/scroll-area\";\n\nimport { Package, Image, Plus } from \"lucide-react\";\nimport { CategoryCreateData } from \"@/lib/api/categories/schema\";\nimport { toast } from \"sonner\";\nimport { Button } from \"@/components/ui/button\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { createCategory } from \"@/lib/api/categories\";\nimport { Dropzone, FileWithMetadata } from \"@/components/ui/dropzone\";\n\nexport default function CategoryForm() {\n  const [open, setOpen] = useState(false);\n  const [s3Files, setS3Files] = useState<FileWithMetadata[]>([]);\n\n  const form = useForm<CategoryCreateData>({\n    defaultValues: {\n      name: \"\",\n      description: \"\",\n      image: \"\",\n      isFeatured: false,\n      isActive: true,\n    },\n  });\n\n  const queryClient = useQueryClient();\n\n  const mutation = useMutation({\n    mutationFn: createCategory,\n    onSuccess: () => {\n      // Invalidate and refetch category query\n      queryClient.invalidateQueries({ queryKey: [\"categories\"] });\n      toast.success(\"Category Created successfully\");\n      setOpen(false);\n      form.reset();\n    },\n  });\n\n  const onSubmit = (data: CategoryCreateData) => {\n    const fileData = s3Files[0];\n    // url?size=&&key=&&p=aws&&name=\n    const image = `${fileData.publicUrl}?size=${fileData.file.size}&&key=${fileData.key}&&p=${fileData.provider}&&name=${fileData.file.name}&&type=${fileData.file.type}`;\n\n    const category = {\n      name: data.name,\n      description: data.description,\n      image: image,\n      isFeatured: data.isFeatured,\n      isActive: data.isActive,\n    };\n\n    mutation.mutate(category);\n  };\n\n  const onCancel = (): void => {\n    form.reset();\n    setOpen(false);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={setOpen}>\n      <DialogTrigger asChild>\n        <Button>\n          <Plus className=\"h-5 w-5 mr-2\" />\n          Add New Category\n        </Button>\n      </DialogTrigger>\n\n      <DialogContent className=\"max-w-2xl max-h-[90vh] p-0\">\n        <DialogHeader className=\" pt-6 px-6 rounded-t-lg\">\n          <div className=\"flex items-center justify-between \">\n            <div>\n              <DialogTitle className=\"flex items-center gap-2 text-xl\">\n                <Package className=\"h-5 w-5\" />\n                Create New Category\n              </DialogTitle>\n              <DialogDescription className=\" mt-1\">\n                Fill in the details below to create your category listing\n              </DialogDescription>\n            </div>\n          </div>\n        </DialogHeader>\n\n        <ScrollArea className=\" max-h-[calc(90vh-140px)]\">\n          <div className=\" px-6 pb-6\">\n            <Form {...form}>\n              <form\n                onSubmit={form.handleSubmit(onSubmit)}\n                className=\"space-y-4\"\n              >\n                {/* Product Name */}\n                <FormField\n                  control={form.control}\n                  name=\"name\"\n                  rules={{\n                    required: \"Category name is required\",\n                    minLength: {\n                      value: 3,\n                      message: \"Category name must be at least 3 characters\",\n                    },\n                  }}\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-700 font-semibold\">\n                        Category Name *\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"Enter category name...\"\n                          className=\"border-gray-300 focus:border-blue-500 focus:ring-blue-500\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Description */}\n                <FormField\n                  control={form.control}\n                  name=\"description\"\n                  render={({ field }) => (\n                    <FormItem>\n                      <FormLabel className=\"text-gray-700 font-semibold\">\n                        Description\n                      </FormLabel>\n                      <FormControl>\n                        <Textarea\n                          placeholder=\"Describe your category...\"\n                          className=\"border-gray-300 focus:border-blue-500 focus:ring-blue-500 min-h-16 resize-none\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormDescription className=\"text-xs\">\n                        {field.value?.length || 0}/500 characters\n                      </FormDescription>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Image URL (hidden) */}\n                <FormField\n                  control={form.control}\n                  name=\"image\"\n                  render={({ field }) => (\n                    <FormItem className=\"hidden\">\n                      <FormLabel className=\"text-gray-700 font-semibold flex items-center gap-1\">\n                        <Image className=\"h-4 w-4\" />\n                        Image URL *\n                      </FormLabel>\n                      <FormControl>\n                        <Input\n                          placeholder=\"https://example.com/image.jpg\"\n                          className=\"border-gray-300 focus:border-blue-500 focus:ring-blue-500\"\n                          {...field}\n                        />\n                      </FormControl>\n                      <FormMessage />\n                    </FormItem>\n                  )}\n                />\n\n                {/* Dropzone */}\n                <div className=\"\">\n                  <Dropzone\n                    provider=\"cloudflare\"\n                    variant=\"compact\"\n                    maxFiles={1}\n                    maxSize={1024 * 1024 * 50} // 50MB\n                    onFilesChange={setS3Files}\n                  />\n                </div>\n\n                {/* Active and featured */}\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <FormField\n                    control={form.control}\n                    name=\"isFeatured\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-col justify-end\">\n                        <FormLabel className=\"text-gray-700 font-semibold\">\n                          Is Featured\n                        </FormLabel>\n                        <div className=\"flex items-center space-x-2 h-10\">\n                          <FormControl>\n                            <Switch\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                            />\n                          </FormControl>\n                          <Label className=\"text-sm text-gray-600\">\n                            {field.value ? \"Yes\" : \"No\"}\n                          </Label>\n                        </div>\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"isActive\"\n                    render={({ field }) => (\n                      <FormItem className=\"flex flex-col justify-end\">\n                        <FormLabel className=\"text-gray-700 font-semibold\">\n                          Is Active\n                        </FormLabel>\n                        <div className=\"flex items-center space-x-2 h-10\">\n                          <FormControl>\n                            <Switch\n                              checked={field.value}\n                              onCheckedChange={field.onChange}\n                            />\n                          </FormControl>\n                          <Label className=\"text-sm text-gray-600\">\n                            {field.value ? \"Yes\" : \"No\"}\n                          </Label>\n                        </div>\n                      </FormItem>\n                    )}\n                  />\n                </div>\n\n                <div className=\"flex gap-3 pt-4 border-t\">\n                  <Button\n                    type=\"submit\"\n                    className=\"flex-1\"\n                    variant={\"default\"}\n                    disabled={mutation.isPending}\n                  >\n                    {mutation.isPending ? \"Processing\" : \" Create Category\"}\n                  </Button>\n\n                  <Button\n                    type=\"button\"\n                    onClick={onCancel}\n                    disabled={mutation.isPending}\n                    variant=\"outline\"\n                    className=\"flex-1 border-gray-300 text-gray-700 hover:bg-gray-50\"\n                  >\n                    Cancel\n                  </Button>\n                </div>\n              </form>\n            </Form>\n          </div>\n        </ScrollArea>\n      </DialogContent>\n    </Dialog>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/file-storage/categories/CategoryForm.tsx"
    },
    {
      "path": "registry/new-york/file-storage/components/file-storage/categories/DeleteCategoryButton.tsx",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Trash2, Loader2, X } from \"lucide-react\";\nimport { deleteCategoryById } from \"@/lib/api/categories\";\n\ninterface DeleteCategoryButtonProps {\n  categoryId: string;\n  categoryName?: string;\n}\n\nexport function DeleteCategoryButton({\n  categoryId,\n  categoryName,\n}: DeleteCategoryButtonProps) {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const queryClient = useQueryClient();\n\n  const deleteMutation = useMutation({\n    mutationFn: deleteCategoryById,\n    onSuccess: () => {\n      queryClient.invalidateQueries({\n        queryKey: [\"categories\", \"form-categories\"],\n      });\n      setIsModalOpen(false);\n    },\n  });\n\n  const handleDelete = () => {\n    deleteMutation.mutate(categoryId);\n  };\n\n  const handleClose = () => {\n    if (!deleteMutation.isPending) {\n      setIsModalOpen(false);\n    }\n  };\n\n  return (\n    <>\n      {/* Delete Button */}\n      <button\n        onClick={() => setIsModalOpen(true)}\n        className=\"inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-red-600 hover:text-red-700 hover:bg-red-50 rounded-md transition-colors\"\n        disabled={deleteMutation.isPending}\n      >\n        {deleteMutation.isPending ? (\n          <Loader2 className=\"h-4 w-4 animate-spin\" />\n        ) : (\n          <Trash2 className=\"h-4 w-4\" />\n        )}\n      </button>\n\n      {/* Confirmation Modal */}\n      {isModalOpen && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n          {/* Backdrop */}\n          <div className=\"absolute inset-0 bg-black/50\" onClick={handleClose} />\n\n          {/* Modal */}\n          <div className=\"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6\">\n            {/* Close Button */}\n            <button\n              onClick={handleClose}\n              disabled={deleteMutation.isPending}\n              className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50\"\n              aria-label=\"Close\"\n            >\n              <X className=\"h-5 w-5\" />\n            </button>\n\n            {/* Header */}\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2 pr-8 text-left\">\n              Delete this category?\n            </h3>\n\n            {/* Description */}\n            <p className=\"text-gray-600 mb-6 text-left border-b border-gray-200 pb-2\">\n              Deleting{\" \"}\n              {categoryName ? (\n                <span className=\"font-medium\">&quot;{categoryName}&quot;</span>\n              ) : (\n                \"this category\"\n              )}{\" \"}\n              is permanent and cannot be undone.\n            </p>\n\n            {/* Error Message */}\n            {deleteMutation.isError && (\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-md\">\n                <p className=\"text-sm text-red-600\">\n                  {deleteMutation.error instanceof Error\n                    ? deleteMutation.error.message\n                    : \"Failed to delete category\"}\n                </p>\n              </div>\n            )}\n\n            {/* Actions */}\n            <div className=\"flex gap-3 justify-end\">\n              <button\n                onClick={handleClose}\n                disabled={deleteMutation.isPending}\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-md transition-colors disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleDelete}\n                disabled={deleteMutation.isPending}\n                className=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors disabled:opacity-50\"\n              >\n                {deleteMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    Deleting...\n                  </>\n                ) : (\n                  \"Delete\"\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/file-storage/categories/DeleteCategoryButton.tsx"
    },
    {
      "path": "registry/new-york/file-storage/components/file-storage/files/Files.tsx",
      "content": "/* eslint-disable @next/next/no-img-element */\n\"use client\";\n\nimport React, { useState } from \"react\";\nimport {\n  Search,\n  Filter,\n  ChevronLeft,\n  ChevronRight,\n  RefreshCcw,\n  HardDrive,\n  FileText,\n  TrendingUp,\n} from \"lucide-react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { getFiles, getStorageStats } from \"@/lib/api/files\";\nimport { getNormalDate } from \"@/lib/getNormalDate\";\nimport { QueryErrorDisplay } from \"@/components/ui/error-display\";\nimport { DeleteFileButton } from \"./DeleteFileButton\";\n\n// Loading Skeleton Component\nconst TableSkeleton = () => {\n  return (\n    <tbody>\n      {[...Array(5)].map((_, i) => (\n        <tr key={i} className=\"border-b border-slate-100\">\n          <td className=\"px-8 py-5\">\n            <div className=\"flex items-center gap-4 animate-pulse\">\n              <div className=\"w-10 h-10 rounded-lg bg-slate-200 shrink-0\"></div>\n              <div className=\"h-4 bg-slate-200 rounded w-32\"></div>\n            </div>\n          </td>\n          <td className=\"px-8 py-5\">\n            <div className=\"h-6 bg-slate-200 rounded-full w-16 animate-pulse\"></div>\n          </td>\n          <td className=\"px-8 py-5\">\n            <div className=\"h-4 bg-slate-200 rounded w-20 animate-pulse\"></div>\n          </td>\n          <td className=\"px-8 py-5\">\n            <div className=\"h-6 bg-slate-200 rounded-xl w-24 animate-pulse\"></div>\n          </td>\n          <td className=\"px-8 py-5\">\n            <div className=\"h-4 bg-slate-200 rounded w-24 animate-pulse\"></div>\n          </td>\n          <td className=\"px-8 py-5\">\n            <div className=\"flex justify-end gap-1\">\n              <div className=\"w-9 h-9 bg-slate-200 rounded-xl animate-pulse\"></div>\n              <div className=\"w-9 h-9 bg-slate-200 rounded-xl animate-pulse\"></div>\n            </div>\n          </td>\n        </tr>\n      ))}\n    </tbody>\n  );\n};\n\n// Helper function to format bytes\nfunction formatBytes(bytes: number, decimals = 2): string {\n  if (bytes === 0) return \"0 Bytes\";\n  const k = 1024;\n  const dm = decimals < 0 ? 0 : decimals;\n  const sizes = [\"Bytes\", \"KB\", \"MB\", \"GB\", \"TB\"];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + \" \" + sizes[i];\n}\n\nconst Files: React.FC = () => {\n  const [searchTerm, setSearchTerm] = useState(\"\");\n  const [page, setPage] = useState(1);\n  const itemsPerPage = 10;\n\n  // Fetch files\n  const {\n    data: files = [],\n    isLoading: filesLoading,\n    error: filesError,\n    refetch: refetchFiles,\n  } = useQuery({\n    queryKey: [\"files\"],\n    queryFn: getFiles,\n  });\n\n  // Fetch storage stats\n  const {\n    data: stats,\n    isLoading: statsLoading,\n    refetch: refetchStats,\n  } = useQuery({\n    queryKey: [\"storage-stats\"],\n    queryFn: getStorageStats,\n  });\n\n  const handleRefresh = () => {\n    refetchFiles();\n    refetchStats();\n  };\n\n  // Filter and paginate\n  const filtered = files.filter(\n    (f) =>\n      f.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n      f.key.toLowerCase().includes(searchTerm.toLowerCase())\n  );\n\n  const totalPages = Math.ceil(filtered.length / itemsPerPage);\n  const paginated = filtered.slice(\n    (page - 1) * itemsPerPage,\n    page * itemsPerPage\n  );\n\n  return (\n    <div className=\"space-y-8 animate-in fade-in duration-500\">\n      {/* Header */}\n      <div className=\"flex flex-col md:flex-row justify-between items-start md:items-center gap-4\">\n        <div>\n          <h1 className=\"text-4xl font-black text-slate-900 tracking-tight\">\n            File Storage\n          </h1>\n          <p className=\"text-slate-500 font-medium\">\n            Manage your uploaded files and monitor storage usage.\n          </p>\n        </div>\n        <Button size=\"icon\" onClick={handleRefresh}>\n          <RefreshCcw />\n        </Button>\n      </div>\n\n      {/* Analytics Cards */}\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        {/* Total Storage Used */}\n        <div className=\" rounded-3xl p-6 shadow-sm border border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <HardDrive className=\"w-8 h-8 opacity-80\" />\n            <span className=\"text-sm font-bold opacity-80\">STORAGE</span>\n          </div>\n          {statsLoading ? (\n            <div className=\"h-12 bg-white/80 rounded-lg animate-pulse\" />\n          ) : (\n            <>\n              <div className=\"text-3xl font-black mb-1\">\n                {formatBytes(stats?.totalSize || 0)}\n              </div>\n              {/* Progress Bar */}\n              <div className=\"mt-4 bg-white/20 rounded-full h-2 overflow-hidden\">\n                <div\n                  className=\"bg-white h-full rounded-full transition-all duration-500\"\n                  style={{\n                    width: `${Math.min(stats?.usedPercentage || 0, 100)}%`,\n                  }}\n                />\n              </div>\n            </>\n          )}\n        </div>\n\n        {/* Total Files */}\n        <div className=\"rounded-3xl p-6 shadow-sm border border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <FileText className=\"w-8 h-8 opacity-80\" />\n            <span className=\"text-sm font-bold opacity-80\">TOTAL FILES</span>\n          </div>\n          {statsLoading ? (\n            <div className=\"h-12 bg-white/80 rounded-lg animate-pulse\" />\n          ) : (\n            <>\n              <div className=\"text-3xl font-black mb-1\">\n                {stats?.totalFiles.toLocaleString() || 0}\n              </div>\n              <div className=\"text-sm opacity-80\">files uploaded</div>\n            </>\n          )}\n        </div>\n\n        {/* This Month */}\n        <div className=\"rounded-3xl p-6 shadow-sm border border-gray-200\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <TrendingUp className=\"w-8 h-8 opacity-80\" />\n            <span className=\"text-sm font-bold opacity-80\">THIS MONTH</span>\n          </div>\n          {statsLoading ? (\n            <div className=\"h-12 bg-white/20 rounded-lg animate-pulse\" />\n          ) : (\n            <>\n              <div className=\"text-3xl font-black mb-1\">\n                {stats?.filesThisMonth || 0}\n              </div>\n              <div className=\"text-sm opacity-80\">files uploaded</div>\n            </>\n          )}\n        </div>\n      </div>\n\n      {/* Files Table */}\n      <div className=\"bg-white rounded-[40px] border border-slate-200 shadow-sm overflow-hidden flex flex-col\">\n        {/* Search Bar */}\n        <div className=\"p-6 border-b border-slate-100 flex flex-col md:flex-row gap-4 justify-between items-center\">\n          <div className=\"relative w-full md:w-96 group\">\n            <Search className=\"absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400 group-focus-within:text-indigo-600 transition-colors\" />\n            <input\n              type=\"text\"\n              placeholder=\"Search files...\"\n              value={searchTerm}\n              onChange={(e) => setSearchTerm(e.target.value)}\n              className=\"w-full pl-12 pr-4 py-3 bg-slate-50 border border-slate-100 rounded-2xl text-sm font-medium focus:outline-none focus:ring-4 focus:ring-indigo-50 transition-all\"\n            />\n          </div>\n          <div className=\"flex gap-3 w-full md:w-auto\">\n            <button className=\"flex-1 md:flex-none flex items-center justify-center gap-2 px-5 py-3 bg-white border border-slate-200 rounded-2xl text-sm font-bold text-slate-700 hover:bg-slate-50 transition-all\">\n              <Filter className=\"w-4 h-4\" /> All Providers\n            </button>\n          </div>\n        </div>\n\n        {/* Table */}\n        <div className=\"overflow-x-auto\">\n          <table className=\"w-full text-left\">\n            <thead className=\"bg-slate-50/50 text-slate-400 text-[10px] font-black uppercase tracking-widest border-b border-slate-100\">\n              <tr>\n                <th className=\"px-8 py-5\">File Name</th>\n                <th className=\"px-8 py-5\">Type</th>\n                <th className=\"px-8 py-5\">Size</th>\n                <th className=\"px-8 py-5\">Provider</th>\n                <th className=\"px-8 py-5\">Uploaded</th>\n                <th className=\"px-8 py-5 text-right\">Actions</th>\n              </tr>\n            </thead>\n            {filesLoading && <TableSkeleton />}\n            <tbody className=\"divide-y divide-slate-100\">\n              {paginated.length > 0\n                ? paginated.map((file) => {\n                    const uploadDate = getNormalDate(file.createdAt);\n                    return (\n                      <tr\n                        key={file.id}\n                        className=\"group hover:bg-slate-50/80 transition-all\"\n                      >\n                        <td className=\"px-8 py-5\">\n                          <div className=\"flex items-center gap-4\">\n                            <div className=\"w-10 h-10 rounded-lg bg-slate-100 flex items-center justify-center shrink-0\">\n                              {file.type.startsWith(\"image/\") ? (\n                                <img\n                                  src={file.publicUrl}\n                                  alt={file.name}\n                                  className=\"w-full h-full object-cover rounded-lg\"\n                                />\n                              ) : (\n                                <FileText className=\"w-5 h-5 text-slate-400\" />\n                              )}\n                            </div>\n                            <span className=\"font-bold text-slate-900 truncate max-w-xs\">\n                              {file.name}\n                            </span>\n                          </div>\n                        </td>\n                        <td className=\"px-8 py-5\">\n                          <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-slate-100 text-slate-600\">\n                            {file.type.split(\"/\")[1]?.toUpperCase() || \"FILE\"}\n                          </span>\n                        </td>\n                        <td className=\"px-8 py-5 text-sm font-medium text-slate-500\">\n                          {formatBytes(file.size)}\n                        </td>\n                        <td className=\"px-8 py-5\">\n                          <span\n                            className={`px-3 py-1.5 rounded-xl text-[10px] font-black uppercase tracking-wider ${\n                              file.provider === \"cloudflare\"\n                                ? \"bg-orange-50 text-orange-600\"\n                                : \"bg-amber-50 text-amber-600\"\n                            }`}\n                          >\n                            {file.provider}\n                          </span>\n                        </td>\n                        <td className=\"px-8 py-5 text-sm font-bold text-slate-400\">\n                          {uploadDate}\n                        </td>\n                        <td className=\"px-8 py-5 text-right\">\n                          <div className=\"flex justify-end gap-1\">\n                            <a\n                              href={file.publicUrl}\n                              target=\"_blank\"\n                              rel=\"noopener noreferrer\"\n                              className=\"p-2.5 text-slate-400 hover:text-indigo-600 rounded-xl transition-all\"\n                            >\n                              <svg\n                                className=\"w-4 h-4\"\n                                fill=\"none\"\n                                stroke=\"currentColor\"\n                                viewBox=\"0 0 24 24\"\n                              >\n                                <path\n                                  strokeLinecap=\"round\"\n                                  strokeLinejoin=\"round\"\n                                  strokeWidth={2}\n                                  d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\"\n                                />\n                              </svg>\n                            </a>\n                            <DeleteFileButton\n                              fileKey={file.key}\n                              fileName={file.name}\n                              provider={file.provider}\n                            />\n                          </div>\n                        </td>\n                      </tr>\n                    );\n                  })\n                : !filesLoading && (\n                    <tr>\n                      <td colSpan={6} className=\"px-8 py-12 text-center\">\n                        <FileText className=\"w-12 h-12 text-slate-300 mx-auto mb-3\" />\n                        <p className=\"text-slate-500 font-medium\">\n                          No files uploaded yet\n                        </p>\n                      </td>\n                    </tr>\n                  )}\n              {filesError && (\n                <tr>\n                  <td colSpan={6}>\n                    <QueryErrorDisplay\n                      error={filesError as Error}\n                      onRetry={refetchFiles}\n                      title=\"Failed to load files\"\n                    />\n                  </td>\n                </tr>\n              )}\n            </tbody>\n          </table>\n        </div>\n\n        {/* Pagination */}\n        <div className=\"p-6 bg-slate-50/50 border-t border-slate-100 flex flex-col sm:flex-row justify-between items-center gap-4\">\n          <div className=\"text-xs font-bold text-slate-500\">\n            Showing <span className=\"text-slate-900\">{paginated.length}</span>{\" \"}\n            of <span className=\"text-slate-900\">{filtered.length}</span> files\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <button\n              disabled={page === 1}\n              onClick={() => setPage((p) => p - 1)}\n              className=\"p-2 text-slate-400 hover:text-indigo-600 disabled:opacity-30 transition-all\"\n            >\n              <ChevronLeft className=\"w-5 h-5\" />\n            </button>\n            <span className=\"text-xs font-black text-slate-900 px-4\">\n              Page {page} of {totalPages || 1}\n            </span>\n            <button\n              disabled={page >= totalPages}\n              onClick={() => setPage((p) => p + 1)}\n              className=\"p-2 text-slate-400 hover:text-indigo-600 disabled:opacity-30 transition-all\"\n            >\n              <ChevronRight className=\"w-5 h-5\" />\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default Files;\n",
      "type": "registry:component",
      "target": "components/file-storage/files/Files.tsx"
    },
    {
      "path": "registry/new-york/file-storage/components/file-storage/files/DeleteFileButton.tsx",
      "content": "\"use client\";\n\nimport { useState } from \"react\";\nimport { useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Trash2, Loader2, X } from \"lucide-react\";\nimport { deleteFile } from \"@/lib/api/files\";\n\ninterface DeleteFileButtonProps {\n  fileKey: string;\n  fileName: string;\n  provider: \"aws\" | \"cloudflare\";\n}\n\nexport function DeleteFileButton({\n  fileKey,\n  fileName,\n  provider,\n}: DeleteFileButtonProps) {\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const queryClient = useQueryClient();\n\n  const deleteMutation = useMutation({\n    mutationFn: async () => deleteFile(fileKey, provider),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"files\"] });\n      queryClient.invalidateQueries({ queryKey: [\"storage-stats\"] });\n      setIsModalOpen(false);\n    },\n  });\n\n  const handleDelete = () => {\n    deleteMutation.mutate();\n  };\n\n  const handleClose = () => {\n    if (!deleteMutation.isPending) {\n      setIsModalOpen(false);\n    }\n  };\n\n  return (\n    <>\n      <button\n        onClick={() => setIsModalOpen(true)}\n        className=\"p-2.5 text-slate-400 hover:text-red-600 rounded-xl transition-all\"\n        disabled={deleteMutation.isPending}\n      >\n        {deleteMutation.isPending ? (\n          <Loader2 className=\"w-4 h-4 animate-spin\" />\n        ) : (\n          <Trash2 className=\"w-4 h-4\" />\n        )}\n      </button>\n\n      {isModalOpen && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n          <div className=\"absolute inset-0 bg-black/50\" onClick={handleClose} />\n          <div className=\"relative bg-white rounded-lg shadow-xl max-w-md w-full mx-4 p-6\">\n            <button\n              onClick={handleClose}\n              disabled={deleteMutation.isPending}\n              className=\"absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors disabled:opacity-50\"\n              aria-label=\"Close\"\n            >\n              <X className=\"h-5 w-5\" />\n            </button>\n\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-2 pr-8\">\n              Delete this file?\n            </h3>\n\n            <p className=\"text-gray-600 mb-6\">\n              Deleting <span className=\"font-medium\">{fileName}</span> from\n              storage is permanent and cannot be undone.\n            </p>\n\n            {deleteMutation.isError && (\n              <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-md\">\n                <p className=\"text-sm text-red-600\">\n                  {deleteMutation.error instanceof Error\n                    ? deleteMutation.error.message\n                    : \"Failed to delete file\"}\n                </p>\n              </div>\n            )}\n\n            <div className=\"flex gap-3 justify-end\">\n              <button\n                onClick={handleClose}\n                disabled={deleteMutation.isPending}\n                className=\"px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100 rounded-md transition-colors disabled:opacity-50\"\n              >\n                Cancel\n              </button>\n              <button\n                onClick={handleDelete}\n                disabled={deleteMutation.isPending}\n                className=\"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors disabled:opacity-50\"\n              >\n                {deleteMutation.isPending ? (\n                  <>\n                    <Loader2 className=\"h-4 w-4 animate-spin\" />\n                    Deleting...\n                  </>\n                ) : (\n                  \"Delete\"\n                )}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/file-storage/files/DeleteFileButton.tsx"
    },
    {
      "path": "registry/new-york/file-storage/lib/s3Client.ts",
      "content": "import \"server-only\";\nimport { S3Client } from \"@aws-sdk/client-s3\";\n\nexport const s3Client = new S3Client({\n  region: process.env.AWS_S3_REGION!,\n  credentials: {\n    accessKeyId: process.env.AWS_S3_ACCESS_KEY_ID!,\n    secretAccessKey: process.env.AWS_S3_SECRET_ACCESS_KEY!,\n  },\n});\n",
      "type": "registry:lib",
      "target": "lib/s3Client.ts"
    },
    {
      "path": "registry/new-york/file-storage/lib/r2Client.ts",
      "content": "import \"server-only\";\nimport { S3Client } from \"@aws-sdk/client-s3\";\n\nexport const r2Client = new S3Client({\n  region: \"auto\",\n  endpoint: process.env.CLOUDFLARE_R2_ENDPOINT!,\n  credentials: {\n    accessKeyId: process.env.CLOUDFLARE_R2_ACCESS_KEY_ID!,\n    secretAccessKey: process.env.CLOUDFLARE_R2_SECRET_ACCESS_KEY!,\n  },\n  forcePathStyle: false,\n});\n",
      "type": "registry:lib",
      "target": "lib/r2Client.ts"
    },
    {
      "path": "registry/new-york/file-storage/lib/prisma.ts",
      "content": "import { PrismaClient } from \"@/app/generated/prisma/client\";\nimport { PrismaPg } from \"@prisma/adapter-pg\";\n\nconst globalForPrisma = global as unknown as {\n  prisma: PrismaClient;\n};\n\nconst adapter = new PrismaPg({\n  connectionString: process.env.DATABASE_URL,\n});\n\nconst db =\n  globalForPrisma.prisma ||\n  new PrismaClient({\n    adapter,\n  });\n\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = db;\n\nexport default db;\n",
      "type": "registry:lib",
      "target": "lib/prisma.ts"
    },
    {
      "path": "registry/new-york/file-storage/lib/fileDataExtractor.ts",
      "content": "type Provider = \"aws\" | \"cloudflare\";\n\ninterface FileData {\n  name: string;\n  size: number;\n  publicUrl: string;\n  type: string;\n  key: string;\n  provider: Provider;\n}\n\nexport function extractFileDataFromUrl(imageUrl: string): FileData {\n  // Parse the URL\n  const url = new URL(imageUrl);\n\n  // Extract the base URL (everything before the query string)\n  const publicUrl = url.origin + url.pathname;\n\n  // Extract query parameters\n  const params = url.searchParams;\n  const provider = (params.get(\"p\") || \"\") as Provider;\n  return {\n    name: params.get(\"name\") || \"\",\n    size: parseInt(params.get(\"size\") || \"0\", 10),\n    publicUrl: publicUrl,\n    type: params.get(\"type\") || \"\",\n    key: params.get(\"key\") || \"\",\n    provider: provider,\n  };\n}\n",
      "type": "registry:lib",
      "target": "lib/fileDataExtractor.ts"
    },
    {
      "path": "registry/new-york/file-storage/lib/getNormalDate.ts",
      "content": "export function getNormalDate(inputDate: Date | string): string {\n  const date = typeof inputDate === \"string\" ? new Date(inputDate) : inputDate;\n  const options: Intl.DateTimeFormatOptions = {\n    weekday: \"short\",\n    month: \"short\",\n    day: \"numeric\",\n    year: \"numeric\",\n  };\n  const formattedDate = new Intl.DateTimeFormat(\"en-US\", options).format(date);\n\n  // Add ordinal suffix to the day\n  const day = date.getDate();\n  const suffix =\n    day === 1 || day === 21 || day === 31\n      ? \"st\"\n      : day === 2 || day === 22\n        ? \"nd\"\n        : day === 3 || day === 23\n          ? \"rd\"\n          : \"th\";\n  return formattedDate.replace(/\\b(\\d{1,2})\\b/, `$1${suffix}`);\n}\n",
      "type": "registry:lib",
      "target": "lib/getNormalDate.ts"
    },
    {
      "path": "registry/new-york/file-storage/lib/api/categories/index.ts",
      "content": "import {\n  CategoryCreateData,\n  DashboardCategory,\n  FormCategory,\n} from \"./schema\";\n\nexport async function getHomeCategories(): Promise<DashboardCategory[]> {\n  const response = await fetch(\"/api/v1/categories\");\n  if (!response.ok) {\n    throw new Error(\"Failed to fetch categories\");\n  }\n  return response.json();\n}\n\nexport async function getFormCategories(): Promise<FormCategory[]> {\n  const response = await fetch(\"/api/v1/categories/form-categories\");\n  if (!response.ok) {\n    throw new Error(\"Failed to fetch categories\");\n  }\n  return response.json();\n}\n\nexport async function deleteCategoryById(id: string) {\n  const response = await fetch(`/api/v1/categories/${id}`, {\n    method: \"DELETE\",\n  });\n  if (!response.ok) {\n    throw new Error(\"Failed to delete category\");\n  }\n  return response.json();\n}\n\nexport async function createCategory(data: CategoryCreateData) {\n  const response = await fetch(\"/api/v1/categories\", {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify(data),\n  });\n  return response.json();\n}\n",
      "type": "registry:lib",
      "target": "lib/api/categories/index.ts"
    },
    {
      "path": "registry/new-york/file-storage/lib/api/categories/schema.ts",
      "content": "import { z } from \"zod\";\n\nexport const BaseCategorySchema = z.object({\n  id: z.string(),\n  slug: z.string(),\n  name: z.string(),\n  description: z.string().optional(),\n  image: z.string(),\n  isFeatured: z.boolean(),\n  isActive: z.boolean(),\n  createdAt: z.date(),\n  updatedAt: z.date(),\n});\n\nexport const CategoryCreateSchema = z.object({\n  name: z.string().min(3),\n  description: z.string().optional(),\n  image: z.string(),\n  isFeatured: z.boolean(),\n  isActive: z.boolean(),\n});\n\nexport const FormCategorySchema = z.object({\n  id: z.string(),\n  name: z.string(),\n});\n\nexport type Category = z.infer<typeof BaseCategorySchema>;\nexport type CategoryCreateData = z.infer<typeof CategoryCreateSchema>;\nexport type DashboardCategory = Category & {\n  productsCount: number;\n};\nexport type FormCategory = z.infer<typeof FormCategorySchema>;\n",
      "type": "registry:lib",
      "target": "lib/api/categories/schema.ts"
    },
    {
      "path": "registry/new-york/file-storage/lib/api/files/index.ts",
      "content": "export interface FileRecord {\n  id: string;\n  name: string;\n  size: number;\n  publicUrl: string;\n  type: string;\n  key: string;\n  provider: \"aws\" | \"cloudflare\";\n  createdAt: string;\n  updatedAt: string;\n}\n\nexport interface StorageStats {\n  totalFiles: number;\n  totalSize: number;\n  usedPercentage: number;\n  maxStorage: number; // in bytes\n  filesThisMonth: number;\n}\n\nexport async function getFiles(): Promise<FileRecord[]> {\n  const response = await fetch(\"/api/v1/files\");\n  if (!response.ok) {\n    throw new Error(\"Failed to fetch files\");\n  }\n  return response.json();\n}\n\nexport async function getStorageStats(): Promise<StorageStats> {\n  const response = await fetch(\"/api/v1/files/stats\");\n  if (!response.ok) {\n    throw new Error(\"Failed to fetch storage stats\");\n  }\n  return response.json();\n}\n\nexport async function deleteFile(key: string, provider: string): Promise<void> {\n  const endpoint = provider === \"aws\" ? \"/api/s3/delete\" : \"/api/r2/delete\";\n  const response = await fetch(endpoint, {\n    method: \"DELETE\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({ key }),\n  });\n\n  if (!response.ok) {\n    throw new Error(\"Failed to delete file\");\n  }\n}\n",
      "type": "registry:lib",
      "target": "lib/api/files/index.ts"
    },
    {
      "path": "registry/new-york/file-storage/app/api/s3/upload/route.ts",
      "content": "import { NextResponse } from \"next/server\";\nimport { PutObjectCommand } from \"@aws-sdk/client-s3\";\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\nimport { s3Client } from \"@/lib/s3Client\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { z } from \"zod\";\n\nconst uploadRequestSchema = z.object({\n  filename: z.string(),\n  contentType: z.string(),\n  size: z.number(),\n});\n\nfunction constructAwsS3Url(\n  key: string,\n  bucketName: string,\n  region: string,\n  customDomain?: string\n): string {\n  if (customDomain) {\n    return `${customDomain}/${encodeURIComponent(key)}`;\n  }\n  return `https://${bucketName}.s3.${region}.amazonaws.com/${encodeURIComponent(\n    key\n  )}`;\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const validation = uploadRequestSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json(\n        { error: \"Invalid request body\" },\n        { status: 400 }\n      );\n    }\n\n    const { filename, contentType, size } = validation.data;\n    const uniqueKey = `${uuidv4()}-${filename}`;\n\n    const command = new PutObjectCommand({\n      Bucket: process.env.AWS_S3_BUCKET_NAME!,\n      Key: uniqueKey,\n      ContentType: contentType,\n      ContentLength: size,\n    });\n\n    const presignedUrl = await getSignedUrl(s3Client, command, {\n      expiresIn: 3600, // URL expires in 1 hour\n    });\n\n    const key = uniqueKey;\n    const bucketName = process.env.AWS_S3_BUCKET_NAME!;\n    const region = process.env.AWS_S3_REGION!;\n    const publicUrl = constructAwsS3Url(key, bucketName, region);\n\n    return NextResponse.json({\n      presignedUrl,\n      key: uniqueKey,\n      publicUrl,\n    });\n  } catch (error) {\n    console.error(\"Error generating presigned URL:\", error);\n    return NextResponse.json(\n      { error: \"Failed to generate upload URL\" },\n      { status: 500 }\n    );\n  }\n}\n",
      "type": "registry:file",
      "target": "app/api/s3/upload/route.ts"
    },
    {
      "path": "registry/new-york/file-storage/app/api/s3/delete/route.ts",
      "content": "import { NextResponse } from \"next/server\";\nimport { DeleteObjectCommand } from \"@aws-sdk/client-s3\";\nimport { s3Client } from \"@/lib/s3Client\";\n\nexport async function DELETE(request: Request) {\n  try {\n    const body = await request.json();\n    const { key } = body;\n\n    if (!key) {\n      return NextResponse.json(\n        { error: \"File key is required\" },\n        { status: 400 }\n      );\n    }\n\n    const command = new DeleteObjectCommand({\n      Bucket: process.env.AWS_S3_BUCKET_NAME!,\n      Key: key,\n    });\n\n    await s3Client.send(command);\n\n    return NextResponse.json(\n      { message: \"File deleted successfully\" },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error(\"Error deleting file:\", error);\n    return NextResponse.json(\n      { error: \"Failed to delete file\" },\n      { status: 500 }\n    );\n  }\n}\n",
      "type": "registry:file",
      "target": "app/api/s3/delete/route.ts"
    },
    {
      "path": "registry/new-york/file-storage/app/api/r2/upload/route.ts",
      "content": "import { NextResponse } from \"next/server\";\nimport { PutObjectCommand } from \"@aws-sdk/client-s3\";\nimport { getSignedUrl } from \"@aws-sdk/s3-request-presigner\";\nimport { r2Client } from \"@/lib/r2Client\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { z } from \"zod\";\n\nconst uploadRequestSchema = z.object({\n  filename: z.string(),\n  contentType: z.string(),\n  size: z.number(),\n});\n\nfunction constructCloudflareR2Url(\n  key: string,\n  publicDevUrl: string,\n  customDomain?: string\n): string {\n  if (customDomain) {\n    return `${customDomain}/${encodeURIComponent(key)}`;\n  }\n  // R2 public URL format (requires public access setup)\n  return `${publicDevUrl}/${encodeURIComponent(key)}`;\n}\n\nexport async function POST(request: Request) {\n  try {\n    const body = await request.json();\n    const validation = uploadRequestSchema.safeParse(body);\n\n    if (!validation.success) {\n      return NextResponse.json(\n        { error: \"Invalid request body\" },\n        { status: 400 }\n      );\n    }\n\n    const { filename, contentType, size } = validation.data;\n    const uniqueKey = `${uuidv4()}-${filename}`;\n\n    const command = new PutObjectCommand({\n      Bucket: process.env.CLOUDFLARE_R2_BUCKET_NAME!,\n      Key: uniqueKey,\n      ContentType: contentType,\n      ContentLength: size,\n    });\n\n    const presignedUrl = await getSignedUrl(r2Client, command, {\n      expiresIn: 3600, // URL expires in 1 hour\n    });\n\n    const key = uniqueKey;\n    const publicDevUrl = process.env.CLOUDFLARE_R2_PUBLIC_DEV_URL!;\n    const publicUrl = constructCloudflareR2Url(key, publicDevUrl);\n\n    return NextResponse.json({\n      presignedUrl,\n      key: uniqueKey,\n      publicUrl,\n    });\n  } catch (error) {\n    console.error(\"Error generating presigned URL:\", error);\n    return NextResponse.json(\n      { error: \"Failed to generate upload URL\" },\n      { status: 500 }\n    );\n  }\n}\n",
      "type": "registry:file",
      "target": "app/api/r2/upload/route.ts"
    },
    {
      "path": "registry/new-york/file-storage/app/api/r2/delete/route.ts",
      "content": "import { NextResponse } from \"next/server\";\nimport { DeleteObjectCommand } from \"@aws-sdk/client-s3\";\nimport { r2Client } from \"@/lib/r2Client\";\n\nexport async function DELETE(request: Request) {\n  try {\n    const body = await request.json();\n    const { key } = body;\n\n    if (!key) {\n      return NextResponse.json(\n        { error: \"File key is required\" },\n        { status: 400 }\n      );\n    }\n\n    const command = new DeleteObjectCommand({\n      Bucket: process.env.CLOUDFLARE_R2_BUCKET_NAME!,\n      Key: key,\n    });\n\n    await r2Client.send(command);\n\n    return NextResponse.json(\n      { message: \"File deleted successfully\" },\n      { status: 200 }\n    );\n  } catch (error) {\n    console.error(\"Error deleting file:\", error);\n    return NextResponse.json(\n      { error: \"Failed to delete file\" },\n      { status: 500 }\n    );\n  }\n}\n",
      "type": "registry:file",
      "target": "app/api/r2/delete/route.ts"
    },
    {
      "path": "registry/new-york/file-storage/app/api/v1/categories/route.ts",
      "content": "import { CategoryCreateData } from \"@/lib/api/categories/schema\";\nimport { extractFileDataFromUrl } from \"@/lib/fileDataExtractor\";\nimport db from \"@/lib/prisma\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\nexport async function GET() {\n  try {\n    const categories = await db.category.findMany({\n      orderBy: {\n        createdAt: \"desc\",\n      },\n    });\n    const result = categories.map((c) => {\n      return {\n        ...c,\n        productsCount: 0,\n      };\n    });\n    return NextResponse.json(result, {\n      status: 200,\n    });\n  } catch (error) {\n    console.log(error);\n    return NextResponse.json(\n      {\n        message: \"Something went wrong\",\n      },\n      {\n        status: 500,\n      }\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body: CategoryCreateData = await request.json();\n    const { name, description, image, isFeatured, isActive } = body;\n\n    // Validate that image exists\n    if (!image || image.trim() === \"\") {\n      return NextResponse.json(\n        {\n          message: \"Image URL is required\",\n        },\n        {\n          status: 400,\n        }\n      );\n    }\n\n    const slug = name.toLowerCase().trim().split(\" \").join(\"-\");\n    const existingCategory = await db.category.findFirst({\n      where: {\n        slug,\n      },\n    });\n\n    if (existingCategory) {\n      return NextResponse.json(\n        {\n          message: \"Category Already exists\",\n        },\n        {\n          status: 409,\n        }\n      );\n    }\n\n    const fileData = extractFileDataFromUrl(image);\n\n    // Create both in a transaction to ensure data consistency\n    await db.$transaction(async (tx) => {\n      await tx.file.create({\n        data: fileData,\n      });\n\n      await tx.category.create({\n        data: {\n          slug,\n          name,\n          description,\n          image,\n          isFeatured,\n          isActive,\n        },\n      });\n    });\n\n    return NextResponse.json(\n      {\n        message: \"Category Created successfully\",\n      },\n      {\n        status: 201,\n      }\n    );\n  } catch (error) {\n    console.log(error);\n    return NextResponse.json(\n      {\n        message: \"Something went wrong\",\n      },\n      {\n        status: 500,\n      }\n    );\n  }\n}\n",
      "type": "registry:file",
      "target": "app/api/v1/categories/route.ts"
    },
    {
      "path": "registry/new-york/file-storage/app/api/v1/categories/[id]/route.ts",
      "content": "import { extractFileDataFromUrl } from \"@/lib/fileDataExtractor\";\nimport db from \"@/lib/prisma\";\nimport { NextResponse } from \"next/server\";\n\nexport async function DELETE(\n  request: Request,\n  {\n    params,\n  }: {\n    params: Promise<{ id: string }>;\n  }\n) {\n  const { id } = await params;\n  try {\n    const existing = await db.category.findUnique({\n      where: {\n        id,\n      },\n    });\n\n    if (!existing) {\n      return NextResponse.json(\n        {\n          message: \"Category Not found\",\n        },\n        {\n          status: 404,\n        }\n      );\n    }\n\n    // Extract file data if image exists\n    let key: string | null = null;\n    let provider: string | null = null;\n\n    if (existing.image && existing.image.trim() !== \"\") {\n      try {\n        const fileData = extractFileDataFromUrl(existing.image);\n        key = fileData.key;\n        provider = fileData.provider;\n      } catch (error) {\n        console.log(\"Failed to extract file data:\", error);\n        // Continue with deletion even if file data extraction fails\n      }\n    }\n\n    // Delete the image from the storage provider\n    if (key && provider) {\n      const endpoint = provider === \"aws\" ? \"/api/s3/delete\" : \"/api/r2/delete\";\n      try {\n        const baseUrl = process.env.NEXT_PUBLIC_API_URL || \"http://localhost:3000\";\n        const response = await fetch(`${baseUrl}${endpoint}`, {\n          method: \"DELETE\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify({ key }),\n        });\n\n        if (!response.ok) {\n          console.log(\"Failed to delete file from storage\");\n        }\n      } catch (error) {\n        console.log(\"Error deleting file from storage:\", error);\n        // Continue with category deletion even if file deletion fails\n      }\n    }\n\n    // Delete the file record from database (if it exists)\n    if (key) {\n      try {\n        await db.file.deleteMany({\n          where: {\n            key,\n          },\n        });\n      } catch (error) {\n        console.log(\"Failed to delete file record:\", error);\n      }\n    }\n\n    // Delete the category\n    await db.category.delete({\n      where: {\n        id,\n      },\n    });\n\n    return NextResponse.json(\n      {\n        message: \"Category deleted successfully\",\n      },\n      {\n        status: 200,\n      }\n    );\n  } catch (error) {\n    console.log(error);\n    return NextResponse.json(\n      {\n        message: \"Something went wrong\",\n      },\n      {\n        status: 500,\n      }\n    );\n  }\n}\n",
      "type": "registry:file",
      "target": "app/api/v1/categories/[id]/route.ts"
    },
    {
      "path": "registry/new-york/file-storage/app/api/v1/files/route.ts",
      "content": "import db from \"@/lib/prisma\";\nimport { NextResponse } from \"next/server\";\n\nexport async function GET() {\n  try {\n    const files = await db.file.findMany({\n      orderBy: {\n        createdAt: \"desc\",\n      },\n    });\n    return NextResponse.json(files, {\n      status: 200,\n    });\n  } catch (error) {\n    console.log(error);\n    return NextResponse.json(\n      {\n        message: \"Something went wrong\",\n      },\n      {\n        status: 500,\n      }\n    );\n  }\n}\n",
      "type": "registry:file",
      "target": "app/api/v1/files/route.ts"
    },
    {
      "path": "registry/new-york/file-storage/app/api/v1/files/stats/route.ts",
      "content": "import db from \"@/lib/prisma\";\nimport { NextResponse } from \"next/server\";\n\nexport async function GET() {\n  try {\n    // Get all files\n    const files = await db.file.findMany();\n\n    // Calculate total size\n    const totalSize = files.reduce((acc, file) => acc + file.size, 0);\n\n    // Get files from this month\n    const now = new Date();\n    const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);\n    const filesThisMonth = await db.file.count({\n      where: {\n        createdAt: {\n          gte: startOfMonth,\n        },\n      },\n    });\n\n    // Set max storage (e.g., 1GB = 1073741824 bytes)\n    const maxStorage = 1073741824; // 1GB\n    const usedPercentage = (totalSize / maxStorage) * 100;\n\n    const stats = {\n      totalFiles: files.length,\n      totalSize,\n      usedPercentage,\n      maxStorage,\n      filesThisMonth,\n    };\n\n    return NextResponse.json(stats, { status: 200 });\n  } catch (error) {\n    console.log(error);\n    return NextResponse.json(\n      { message: \"Something went wrong\" },\n      { status: 500 }\n    );\n  }\n}\n",
      "type": "registry:file",
      "target": "app/api/v1/files/stats/route.ts"
    },
    {
      "path": "registry/new-york/file-storage/app/(example)/categories/page.tsx",
      "content": "// import Categories from \"@/components/file-storage/categories/Categories\";\n\nimport Categories from \"@/components/dashboard/categories/Categories\";\n\nexport default function CategoriesPage() {\n  return (\n    <div className=\"container mx-auto py-10 px-4\">\n      <Categories />\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "app/(example)/categories/page.tsx"
    },
    {
      "path": "registry/new-york/file-storage/app/(example)/file-storage/page.tsx",
      "content": "// import Files from \"@/components/file-storage/files/Files\";\n\nimport Files from \"@/components/dashboard/files/Files\";\n\nexport default function FileStoragePage() {\n  return (\n    <div className=\"container mx-auto py-10 px-4\">\n      <Files />\n    </div>\n  );\n}\n",
      "type": "registry:page",
      "target": "app/(example)/file-storage/page.tsx"
    },
    {
      "path": "registry/new-york/file-storage/app/(example)/layout.tsx",
      "content": "\"use client\";\n\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"sonner\";\nimport { useState } from \"react\";\n\nexport default function ExampleLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  const [queryClient] = useState(\n    () =>\n      new QueryClient({\n        defaultOptions: {\n          queries: {\n            staleTime: 60 * 1000,\n          },\n        },\n      })\n  );\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      {children}\n      <Toaster position=\"top-right\" richColors />\n    </QueryClientProvider>\n  );\n}\n",
      "type": "registry:file",
      "target": "app/(example)/layout.tsx"
    },
    {
      "path": "registry/new-york/file-storage/prisma/schema.prisma.example",
      "content": "// =============================================================================\n// FILE STORAGE REGISTRY - PRISMA SCHEMA ADDITIONS\n// =============================================================================\n//\n// Add the following models to your existing schema.prisma file.\n// DO NOT replace your entire schema - just add these models.\n//\n// If you don't have a prisma setup yet, follow the Prisma 7 guide:\n// https://www.prisma.io/docs/guides/nextjs\n// =============================================================================\n\n// -----------------------------------------------------------------------------\n// REQUIRED: Add the File model to track uploaded files\n// -----------------------------------------------------------------------------\nmodel File {\n  id        String          @id @default(cuid())\n  name      String\n  size      Int\n  publicUrl String\n  type      String\n  key       String          @unique\n  provider  StorageProvider @default(cloudflare)\n  createdAt DateTime        @default(now())\n  updatedAt DateTime        @updatedAt\n}\n\nenum StorageProvider {\n  aws\n  cloudflare\n}\n\n// -----------------------------------------------------------------------------\n// OPTIONAL: Example Category model with file upload support\n// You can adapt this pattern for any model that needs image/file uploads\n// -----------------------------------------------------------------------------\nmodel Category {\n  id          String   @id @default(cuid())\n  name        String\n  slug        String   @unique\n  image       String   // Stores the file URL with metadata query params\n  description String?\n  isFeatured  Boolean  @default(false)\n  isActive    Boolean  @default(true)\n  createdAt   DateTime @default(now())\n  updatedAt   DateTime @updatedAt\n}\n\n// =============================================================================\n// INTEGRATION NOTES:\n// =============================================================================\n//\n// 1. The `image` field in Category stores the public URL with metadata:\n//    Example: https://bucket.r2.dev/uuid-filename.jpg?size=12345&key=uuid-filename.jpg&p=cloudflare&name=original.jpg&type=image/jpeg\n//\n// 2. When a category is deleted, the API automatically:\n//    - Extracts the file key from the image URL\n//    - Deletes the file from S3/R2\n//    - Deletes the File record from the database\n//\n// 3. You can use the same pattern for any model:\n//    - Add an `image` or `file` field (String type)\n//    - Use the Dropzone component to upload\n//    - Store the URL with metadata in the field\n//\n// =============================================================================\n",
      "type": "registry:file",
      "target": "prisma/schema.prisma.example"
    }
  ],
  "envVars": {
    "DATABASE_URL": "postgresql://user:password@localhost:5432/dbname",
    "AWS_S3_REGION": "us-east-1",
    "AWS_S3_BUCKET_NAME": "your-bucket-name",
    "AWS_S3_ACCESS_KEY_ID": "",
    "AWS_S3_SECRET_ACCESS_KEY": "",
    "CLOUDFLARE_R2_ACCESS_KEY_ID": "",
    "CLOUDFLARE_R2_SECRET_ACCESS_KEY": "",
    "CLOUDFLARE_R2_ENDPOINT": "https://your-account-id.r2.cloudflarestorage.com",
    "CLOUDFLARE_R2_BUCKET_NAME": "your-bucket-name",
    "CLOUDFLARE_R2_PUBLIC_DEV_URL": "https://pub-xxx.r2.dev"
  }
}